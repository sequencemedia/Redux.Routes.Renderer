'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.Renderer=void 0;var _react=require('react'),_react2=_interopRequireDefault(_react),_reactRedux=require('react-redux'),_reactRouter=require('react-router'),_server=require('react-dom/server'),_server2=_interopRequireDefault(_server),_boom=require('boom'),_boom2=_interopRequireDefault(_boom);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var ROUTER_MATCH='Renderer encountered an error raised by ReactRouter.match()',REACT_RENDER='(1) Renderer caught an implementation error in ReactDOMServer.renderToString()',REDUX_RESOLVE='(2) Renderer caught an implementation error in ReactDOMServer.renderToString()',badImplementation=function(a,b){return _boom2.default.wrap(a,500,b)},notFound=function(a){return _boom2.default.notFound('ReactRouter.match() cannot find '+a)},reduce=function(a){return a.concat(function(a){var b=a.needs,c=b===void 0?[]:b;return c})},resolveComponentNeeds=function(a,b,c){return Promise.all(b.reduce(reduce,[]).map(function(b){return a(b(c))}))},renderToString=function(a,b){return _server2.default.renderToString(_react2.default.createElement(_reactRedux.Provider,{store:a},_react2.default.createElement(_reactRouter.RouterContext,b)))},Renderer=exports.Renderer=function a(){_classCallCheck(this,a),this.render=function(a,b,c){return new Promise(function(d,f){(0,_reactRouter.match)({routes:b,location:c},function(g,h,i){var j;if((j=!!g)||!h&&!i)return f(j?badImplementation(g,ROUTER_MATCH):notFound(c));if(h)return d({redirect:h});var b=a.dispatch,k=a.getState,l=i.components,m=i.params;resolveComponentNeeds(b,l,m).then(function(){try{var b=renderToString(a,i),c=k();d({rendered:b,state:c})}catch(a){f(badImplementation(a,REACT_RENDER))}}).catch(function(a){f(badImplementation(a,REDUX_RESOLVE))})})})}};