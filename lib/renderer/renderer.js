'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.Renderer=undefined;var _classCallCheck2=require('babel-runtime/helpers/classCallCheck');var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require('babel-runtime/helpers/createClass');var _createClass3=_interopRequireDefault(_createClass2);var _promise=require('babel-runtime/core-js/promise');var _promise2=_interopRequireDefault(_promise);var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactRedux=require('react-redux');var _reactRouter=require('react-router');var _server=require('react-dom/server');var _server2=_interopRequireDefault(_server);var _boom=require('boom');var _boom2=_interopRequireDefault(_boom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var ROUTER_MATCH='Renderer encountered an error raised by ReactRouter.match()';/* eslint promise/param-names: 0 */var REACT_RENDER='Renderer caught an implemetation error in ReactDOMServer.renderToString()';var REDUX_RESOLVE='Renderer caught an implemetation error in ReactDOMServer.renderToString()';var badImplementation=function badImplementation(message,e){return _boom2.default.badImplementation(message,_boom2.default.wrap(e));};var notFound=function notFound(location){return _boom2.default.notFound('ReactRouter.match() cannot find '+location);};/**
 * @return {Array}
 */var reduce=function reduce(was,now){return was.concat(now?now.needs||[]:[]);};/**
 * @return {Promise}
 */var resolveComponentNeeds=function resolveComponentNeeds(dispatch,components,params){return _promise2.default.all(components.reduce(reduce,[]).map(function(need){return dispatch(need(params));}));};/**
 * @return {String}
 */var renderToString=function renderToString(store,props){return _server2.default.renderToString(_react2.default.createElement(_reactRedux.Provider,{store:store},_react2.default.createElement(_reactRouter.RouterContext,props)));};var Renderer=exports.Renderer=function(){function Renderer(){(0,_classCallCheck3.default)(this,Renderer);}(0,_createClass3.default)(Renderer,[{key:'render',/**
   * @return {Promise}
   */value:function render(store,routes,location){return new _promise2.default(function(success,failure){(0,_reactRouter.match)({routes:routes,location:location},function(e,redirect,props){var b=void 0;if((b=!!e)||!redirect&&!props){return failure(b?badImplementation(ROUTER_MATCH,e):notFound(location));}if(redirect)return success({redirect:redirect});var dispatch=store.dispatch;var components=props.components,params=props.params;resolveComponentNeeds(dispatch,components,params).then(function(){try{var rendered=renderToString(store,props);var state=store.getState();success({rendered:rendered,state:state});}catch(e){failure(badImplementation(REACT_RENDER,e));}}).catch(function(e){failure(badImplementation(REDUX_RESOLVE,e));});});});}}]);return Renderer;}();