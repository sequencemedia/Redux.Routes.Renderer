'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.Renderer=undefined;var _react=require('react');var _react2=_interopRequireDefault(_react);var _reactRedux=require('react-redux');var _reactRouter=require('react-router');var _server=require('react-dom/server');var _server2=_interopRequireDefault(_server);var _boom=require('boom');var _boom2=_interopRequireDefault(_boom);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var REDUCE=[function(payload){return{type:'@@redux/REDUX_ROUTES_RENDERER',payload:payload};}];var ROUTER_MATCH='Renderer encountered an error raised by ReactRouter.match()';var REACT_RENDER='(1) Renderer caught an implementation error in ReactDOMServer.renderToString()';var REDUX_RESOLVE='(2) Renderer caught an implementation error in ReactDOMServer.renderToString()';var badImplementation=function badImplementation(e,message){return _boom2.default.wrap(e,500,message);};var notFound=function notFound(location){return _boom2.default.notFound('ReactRouter.match() cannot find '+location);};/**
 * @return {Array}
 */var reduce=function reduce(was){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},_ref$needs=_ref.needs,now=_ref$needs===undefined?[]:_ref$needs;return was.concat(now);};/**
 * @return {Promise}
 */var resolveComponentNeeds=function resolveComponentNeeds(dispatch,components,params){return Promise.all(components.reduce(reduce,REDUCE).map(function(need){return dispatch(need(params));}));};/**
 * @return {String}
 */var renderToString=function renderToString(store,props){return _server2.default.renderToString(_react2.default.createElement(_reactRedux.Provider,{store:store},_react2.default.createElement(_reactRouter.RouterContext,props)));};var Renderer=exports.Renderer=function Renderer(){_classCallCheck(this,Renderer);this.render=function(store,routes,location){return new Promise(function(resolve,reject){(0,_reactRouter.match)({routes:routes,location:location},function(e,redirect,props){var b=void 0;if((b=!!e)||!redirect&&!props){return reject(b?badImplementation(e,ROUTER_MATCH):notFound(location));}if(redirect)return resolve({redirect:redirect});var dispatch=store.dispatch,getState=store.getState;var components=props.components,params=props.params;resolveComponentNeeds(dispatch,components,params).then(function(){try{var rendered=renderToString(store,props);var state=getState();resolve({rendered:rendered,state:state});}catch(e){reject(badImplementation(e,REACT_RENDER));}}).catch(function(e){reject(badImplementation(e,REDUX_RESOLVE));});});});};}/**
   * @return {Promise}
   */;